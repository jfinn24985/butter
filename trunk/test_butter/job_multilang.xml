<?xml version="1.0"?>
<job>
    <property name="basefile" if="build-style=standard" >makefile</property>
    <property name="sysfile"  if="build-style=standard" >%(make-sys)s</property>
    <property name="mainfile" if="build-style=standard" >makefile</property>
    <property name="basefile" if="build-style=jam">Jamfile</property>
    <property name="sysfile" if="build-style=jam">Jamrules</property>
    <property name="mainfile" if="build-style=jam">Jamfile</property>
    <property name="basefile" if="build-style=make">makefile</property>
    <property name="sysfile" if="build-style=make">%(make-sys)s</property>
    <property name="mainfile" if="build-style=make">makefile</property>
    <property name="basefile" if="build-style=boost">Jamroot</property>
    <property name="sysfile" if="build-style=boost">local.jam</property>
    <property name="mainfile" if="build-style=boost">Jamfile</property>
    <property name="basefile" if="build-style=cmake">CMakeLists.txt</property>
    <property name="sysfile" if="build-style=cmake">local.cmake</property>
    <property name="mainfile" if="build-style=cmake">CMakeLists.txt</property>
    <property name="deploy-base" >%(base-dir)s/%(project)s/trunk/test/%(project)s</property>
    <property name="local-base" >%(deploy-base)s/output</property>
    <stage>Test generating source and build system from a single level project with 2 targets
      <verb-list category="setup">
        Initialise the test location with latest copy of test.
        <verb type="file-list">
          <property name="base">%(base-dir)s</property>
          <property name="file-type">directory</property>
          <property name="verify">recreate</property>
          <property name="location">%(project)s</property>
        </verb>
        <verb type="check-out">
          <property name="base">%(base-dir)s/%(project)s</property>
          <property name="type">%(checkout-tool)s</property>
          <property name="branch">%(project)s%(checkout-suf)s</property>
          <property name="location">%(checkout-url)s/%(branch)s</property>
        </verb>
        <verb type="patch">
          <property name="patch-dir" >%(deploy-base)s/patch</property>
          <property name="base">%(base-dir)s/%(project)s/trunk/test/%(project)s</property>
          <property name="location">%(patch-file)s</property>
        </verb>

      </verb-list>
      <verb-list category="execute">Generate the build system and the source code
        <verb type="system" >%(bouml)s PATH{%(deploy-base)s/%(project)s.prj} -exec %(plug-out2)s -exit</verb>
        <verb type="system" >%(bouml)s PATH{%(deploy-base)s/%(project)s.prj} -exec %(plug-out1)s -test:ok -exit</verb>
        <!-- verb type="system" >%(bouml)s PATH{%(deploy-base)s/%(project)s.prj} -exec %(plug-out1)s -test:ok -exit</verb -->
      </verb-list>
      <verb-list category="verify">Verify that the correct files have been produced
        <property name="test-phrase">1.1.3 Project build files and non-c++ source files created</property>
        <verb type="file-list">
          <property name="base">%(local-base)s/include/Executable</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">example_exe.hpp</property>
        </verb>
        <verb type="file-list">
          <property name="base">%(local-base)s/src/Executable</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">example_exe.cpp %(mainfile)s</property>
        </verb>
        <verb type="file-list">
          <property name="base">%(local-base)s/include/Library</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">example_lib.hpp</property>
        </verb>
        <verb type="file-list">
          <property name="base">%(local-base)s/src/Library</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">example_lib.cpp example_c.c %(mainfile)s</property>
        </verb>
        <verb type="file-list">
          <property name="base">%(local-base)s</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">%(basefile)s %(sysfile)s</property>
        </verb>
      </verb-list>
    </stage>
    <stage>Perform compilation and test compilation success
      <verb-list category="execute" >
       <property name="compile-command"  if="build-style=cmake" >/bin/bash -c "{ pushd PATH{%(local-base)s} %(cmdsep)s
           { PATH{%(build-tool)s} %(build-arg)s &gt; build.log %(cmdsep)s
           PATH{%(build-tool)s} %(build-arg)s &gt;&gt; build.log %(cmdsep)s
           PATH{%(make)s} -k VERBOSE=1 %(make-arg)s install &gt;&gt; build.log %(cmdsep)s
           %(cat)s build.log %(cmdsep)s } %(cmdsep)s popd %(cmdsep)s }" </property>
       <property name="compile-command">/bin/bash -c "{ pushd PATH{%(local-base)s} %(cmdsep)s
           { PATH{%(build-tool)s} %(build-arg)s &gt; build.log %(cmdsep)s
           %(cat)s build.log %(cmdsep)s } %(cmdsep)s popd %(cmdsep)s }" </property>
        <verb type="system" >%(compile-command)s</verb>
      </verb-list>
      <verb-list category="verify">Verify that the correct files have been produced
        <verb type="file-list">
          <property name="base">%(local-base)s/%(stage-bin-dir)s</property>
          <property name="file-type">executable</property>
          <property name="verify">exist</property>
          <property name="location">%(exe-name)s</property>
          <property name="test-phrase">2.1.1 Compiled executable target</property>
        </verb>
      </verb-list>
      <verb-list category="verify">
        Verify that the correct files have been produced
        <verb type="file-list">
          <property name="base">%(local-base)s/src/Library</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">%(library-name)s</property>
          <property name="test-phrase">2.1.2 Compiled library target</property>
        </verb>
       </verb-list>
    </stage>
    <stage>Test run the executable.
      <verb-list category="execute" >Run &quot;program&quot;
	      <verb type="system" >/bin/bash -c "{ pushd PATH{%(local-base)s} %(cmdsep)s %(set-library-path)s PATH{%(local-base)s/%(stage-bin-dir)s/%(exe-name)s} lorem.txt > output %(cmdsep)s popd %(cmdsep)s }" </verb>
      </verb-list>
      <verb-list category="verify">Verify that the correct output has been produced
        <verb type="file-list">
          <property name="base">%(local-base)s</property>
          <property name="file-type">file</property>
          <property name="verify">exist</property>
          <property name="location">output</property>
        </verb>
        <verb type="compare">
          <property name="base">%(local-base)s</property>
          <property name="location">output</property>
          <property name="test-phrase">1.2.1 Program output matchs canon</property>
        </verb>
      </verb-list>
    </stage>
    <stage>Job clean-up stage
      <verb-list category="cleanup">Clean up operations
       <verb type="file-list">
        <property name="base">%(base-dir)s</property>
          <property name="file-type">directory</property>
          <property name="verify">remove</property>
          <property name="location">%(project)s</property>
      </verb>
      </verb-list>
    </stage>
</job>
